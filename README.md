# Demo
Demo with Spring Boot H2 Database Example

### How to run
This project uses maven. You can simply build and run the project itself or run as a docker container.

To run a docker container:
1. Run ```mvn package dockerfile:build```
2. Check whether docker image is there by ```docker image ls```
3. Run docker container ```docker run -d -p 8080:8080 allianz/demo:0.0.1-SNAPSHOT```

### Endpoints

Find the swagger doc under [http://localhost:8080/swagger-ui.html#]()

All endpoints are available here including endpoints generated by spring security. 
Only interested one in our case is ```employee-controller```.

* ```GET /employees```
* ```GET /employees/{id}```
* ```POST /employees``` takes ```EmployeeModel``` in the request body
* ```PATCH /employees/{id}``` takes ```EmployeeModel``` in the request body
* ```DELETE /employees/{id}```

### Access Token

To retrieve the access token to access the resources on the secured endpoints (employee):

Call a  ```POST localhost:8080/oauth/token``` with Basic Auth
* Username = client-id
* Password = secret

And the default user is (Added as a default user in the ```user``` table upon running the service)
* username = user
* password = password
* grant_type = password

The easiest would be to run this command to get the token

```
curl --location --request POST 'localhost:8080/oauth/token' \
--header 'Authorization: Basic Y2xpZW50LWlkOnNlY3JldA==' \
--header 'Content-Type: application/x-www-form-urlencoded' \
--data-urlencode 'username=user' \
--data-urlencode 'password=password' \
--data-urlencode 'grant_type=password'
```

You will get object like this in return. 

```
{
    "access_token": "4b12a6c6-f912-4c9c-9dc3-c2f979aa6619",
    "token_type": "bearer",
    "refresh_token": "540d7ebf-54d8-49a9-8fe8-9073081ddd00",
    "expires_in": 3266,
    "scope": "read write trust"
}
```
The ```access_token``` can then be used for the secured endpoints. For example

```
curl --location --request GET 'localhost:8080/employees' \
--header 'Authorization: Bearer 4b12a6c6-f912-4c9c-9dc3-c2f979aa6619'
```

Note: Do not use the above access token directly. It won't work. Please call the request to get the correct one.

### DB

This project use H2 in memory database. To access the DB: [http://localhost:8080/h2-console]()

* JDBC URL = jdbc:h2:mem:demo
* User name = sa

These are defined in ```application.properties```.

### Code structures
* ```context``` contains all the configuration class
* ```controller``` contains the rest controller class
* ```entity``` contains all the entities for the database
* ```exception``` contains defined exceptions
* ```model``` contains the model for JSON object. This is used for the request body as well as return object. Do not show ID.
* ```repository``` contains all the repository interface using JPARepository. No test is written for these class as I have not implemented anything extra.
* ```service``` contains all the class in service layer

* ```resources/application.properties``` contains some defined properties
* ```resources/data.sql``` initialize default user and some employee data during the start of the service.

### Note

* ```liquidbase``` and ```MapStruct``` are not used.
* Tests are wrtten only for ```service``` layer and intergration test for the ```controller```.